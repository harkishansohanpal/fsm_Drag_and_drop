<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>HTML5 Canvas Oriented Text</title>
    <style type="text/css" media="screen">
      body {
        background: #eee;
        margin: 2em;
        text-align: center;
      }
      canvas {
        border: 1px solid #ccc;
        background: #fff;
        display: block;
        width: 800px;
        height: 600px;
        margin: 1em auto;
      }
      label {
        margin-left: 2em;
      }
      .byline {
        font-style: italic;
        font-size: smaller;
      }
    </style>
  </head>
  <body>
    <p>
      <select id="size">
        <option selected>20pt</option>
      </select>
      <label
        >Alignment:
        <select id="align">
          <option>left</option>
          <option selected>center</option>
          <option>right</option>
        </select></label
      >
      <label
        >Padding: <input type="text" id="padding" size="3" value="10"
      /></label>
    </p>
    <canvas id="c"></canvas>
    <p class="byline"></p>
    <script type="text/javascript" charset="utf-8">
      var size = document.getElementById("size");
      var align = document.getElementById("align");
      var padding = document.getElementById("padding");
      var c = document.getElementById("c");
      c.width = 800;
      c.height = 600;

      var ctx = c.getContext("2d");
      var p1 = { x: 200, y: 200 };
      var p2 = { x: 400, y: 300 };

      ctx.textBaseline = "bottom";
      ctx.lineWidth = 2;
      function drawLabel(ctx, text, p1, p2, alignment, padding) {
        if (!alignment) alignment = "center";
        if (!padding) padding = 0;

        var dx = p2.x - p1.x;
        var dy = p2.y - p1.y;
        var len = Math.sqrt(dx * dx + dy * dy);
        var avail = len - 2 * padding;

        var textToDraw = text;
        if (ctx.measureText && ctx.measureText(textToDraw).width > avail) {
          while (textToDraw && ctx.measureText(textToDraw + "…").width > avail)
            textToDraw = textToDraw.slice(0, -1);
          textToDraw += "…";
        }

        // Keep text upright
        var angle = Math.atan2(dy, dx);
        if (angle < -Math.PI / 2 || angle > Math.PI / 2) {
          var p = p1;
          p1 = p2;
          p2 = p;
          dx *= -1;
          dy *= -1;
          angle -= Math.PI;
        }

        var p, pad;
        if (alignment == "center") {
          p = p1;
          pad = 1 / 2;
        } else {
          var left = alignment == "left";
          p = left ? p1 : p2;
          pad = (padding / len) * (left ? 1 : -1);
        }
        ctx.save();
        ctx.textAlign = alignment;
        ctx.translate(p.x + dx * pad, p.y + dy * pad);
        ctx.rotate(angle);
        ctx.fillText(textToDraw, 0, 0);
        ctx.restore();
      }

      var alignment, padding;
      var redraw = function() {
        ctx.clearRect(0, 0, c.width, c.height);
        ctx.beginPath();
        ctx.stroke();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();

        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.arc(p1.x, p1.y, 3, 0, Math.PI * 2, false);
        ctx.fill();
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(p2.x, p2.y, 3, 0, Math.PI * 2, false);
        ctx.fill();
        ctx.stroke();

        ctx.fillStyle = "#666";

        var label =
          "α = " +
          ((Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180) / Math.PI).toFixed(0) +
          "°";
        ctx.font = size.value + " Arial";
        drawLabel(ctx, label, p1, p2, align.value, padding.value * 1);
      };
      c.onmousemove = function(e) {
        p2.x = e.offsetX;
        p2.y = e.offsetY;
        redraw();
      };
      c.onclick = function(e) {
        p1.x = e.offsetX;
        p1.y = e.offsetY;
        redraw();
      };
      size.onchange = redraw;
      align.onchange = redraw;
      padding.onkeyup = redraw;
      redraw();
    </script>
  </body>
</html>
